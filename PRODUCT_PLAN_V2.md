# 分布式调度平台 - 产品方案 (V2)

## 1. 产品概述

Oasis-Scheduler 是一个企业级的分布式任务调度平台，旨在为分布式应用提供统一、稳定、可视化的任务管理和调度服务。它解决了传统定时任务（如 `crontab`, `Spring @Scheduled`）在分布式环境下的单点、管理困难、状态不可追溯等问题。本平台允许开发者将业务逻辑作为“任务”注册到平台，由平台进行统一的生命周期管理、调度、监控和告警。

## 2. 产品定位

- **面向开发者**: 提供低侵入性、简单易用的SDK，让开发者可以专注于业务逻辑，轻松实现分布式任务。
- **面向运维/SRE**: 提供稳定可靠的调度能力，以及清晰的监控大盘、任务追踪、故障告警和在线运维能力。
- **企业级**: 满足企业对任务调度的高可用、可扩展、安全性和可观测性的要求。

## 3. 功能模块设计

平台功能将集成到 `oasis-admin` (后端调度中心) 和 `oasis-web` (前端控制台) 中。

### 3.1. 调度中心大盘 (Dashboard)

提供调度系统的核心指标概览，是运维和管理员的核心入口。

- **核心指标统计**:
    - **任务总数**: 系统中所有任务的数量。
    - **调度总次数 (24h)**: 最近24小时的总调度次数。
    - **成功/失败次数 (24h)**: 最近24小时的成功与失败统计。
    - **在线应用/节点数**: 当前已注册并保持心跳的应用（执行器）数量和总节点（实例）数量。
- **图表展示**:
    - **调度趋势图**: 按小时展示的调度量（成功/失败）折线图，快速发现异常波动。
    - **任务状态分布**: 展示启用、禁用、运行中等状态的任务数量饼图。
- **实时动态**:
    - **最近调度记录**: 滚动展示最新的10条调度日志。
    - **失败告警**: 突出展示最近的失败任务记录。

### 3.2. 应用管理 (App Management)

用于管理接入调度中心的业务应用，在调度语境下也称为“执行器”。

- **应用列表**:
    - 展示所有注册的应用，包括应用ID (`AppName`)、应用名称、注册方式（自动/手动）、节点列表等。
    - `AppName` 是应用集群的唯一标识。
- **应用详情**:
    - **在线节点**: 显示该应用当前所有在线的节点地址（IP:Port）。
    - **节点状态**: 每个节点的状态（在线/离线）和最近心跳时间。
- **操作**:
    - **���建/编辑应用**:
        - `AppName`: 应用唯一标识，必须与客户端配置保持一致。
        - `Title`: 应用的可读名称/描述。
    - **移除应用**: 删除已下线的应用及其配置。

### 3.3. 任务管理 (Job Management)

平台的核心功能，用于定义、管理和触发调度任务。

- **任务列表**:
    - 以列表形式展示所有调度任务，包含任务ID、任务名称、所属应用、调度策略（如CRON）、任务标识、负责人、状态（启用/禁用）等关键信息。
    - 提供强大的搜索和筛选功能。
- **新建/编辑任务**:
    - **所属应用**: 选择任务在哪个应用 (`AppName`) 中执行。
    - **任务名称**: 任务的可读描述。
    - **路由策略**: 当应用有多个节点时，选择如何分发任务。
        - `轮询`、`随机`、`故障转移` (选择第一个，失败则顺延)、`广播` (所有节点都执行)。
    - **调度配置**:
        - **类型**: CRON任务、固定延时、一次性任务。
        - **值**: CRON表达式或延时毫秒数。
    - **运行配置**:
        - **任务标识 (Handler)**: 任务在客户端代码中的唯一标识。
        - **任务参数**: 调度时固定传递给客户端的参数。
    - **高级配置**:
        - **阻塞策略**: 下次调度来临时，若上次任务未执行完，如何处理？（`串行等待`、`丢弃本次`、`并行执行`）。
        - **失败策略**: 任务失败后如何处理？（`邮件告警`、`自动重试N次`）。
        - **任务超时**: 任务执行超过多长时间判定为超时失败。
    - **责任人**: 任务的负责人及其联系方式（如邮箱），用于接收告警。
- **任务操作**:
    - **触发一次**: 手动立即执行一次任务，可覆盖默认参数。
    - **启用/禁用**: 控制任务是否参与自动调度。
    - **删除**: 永久删除任务。
    - **查看日志**: 快速跳转到该任务的所有调度记录。

### 3.4. 调度日志 (Log Center)

记录每一次任务调度的完整生命周期，是排查问题的关键。

- **日志列表**:
    - 展示每一次调度的记录，包括任务ID、所属应用、执行节点、任务标识、调度时间、调度结果（成功/失败/运行中）、执行耗时等。
    - 支持按任务、应用、时间范围、执行结果进行精确筛选。
- **日志详情 (Trace)**:
    - **调度信息**: 包含完整的调度上下文，如触发类型、路由策略、最终选择的节点、任务参数等。
    - **执行日志**: 实时展示任务在客��端通过SDK上报的业务日志。
    - **操作**:
        - **终止任务 (尽力而为)**: 对正在运行的任务发送中断信号。
        - **重新触发**: 使用相同的参数重新执行一次该调度。

