<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.kevin.oasis.dao.MenuDao">

    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.github.kevin.oasis.models.entity.Menu">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="parent_id" property="parentId" jdbcType="BIGINT"/>
        <result column="menu_type" property="menuType" jdbcType="INTEGER"/>
        <result column="menu_name" property="menuName" jdbcType="VARCHAR"/>
        <result column="route_name" property="routeName" jdbcType="VARCHAR"/>
        <result column="route_path" property="routePath" jdbcType="VARCHAR"/>
        <result column="path_param" property="pathParam" jdbcType="VARCHAR"/>
        <result column="component" property="component" jdbcType="VARCHAR"/>
        <result column="icon_type" property="iconType" jdbcType="VARCHAR"/>
        <result column="icon" property="icon" jdbcType="VARCHAR"/>
        <result column="local_icon" property="localIcon" jdbcType="VARCHAR"/>
        <result column="i18n_key" property="i18nKey" jdbcType="VARCHAR"/>
        <result column="order" property="order" jdbcType="INTEGER"/>
        <result column="keep_alive" property="keepAlive" jdbcType="BOOLEAN"/>
        <result column="constant" property="constant" jdbcType="BOOLEAN"/>
        <result column="href" property="href" jdbcType="VARCHAR"/>
        <result column="hide_in_menu" property="hideInMenu" jdbcType="BOOLEAN"/>
        <result column="active_menu" property="activeMenu" jdbcType="VARCHAR"/>
        <result column="multi_tab" property="multiTab" jdbcType="BOOLEAN"/>
        <result column="fixed_index_in_tab" property="fixedIndexInTab" jdbcType="INTEGER"/>
        <result column="status" property="status" jdbcType="BOOLEAN"/>
        <result column="create_by" property="createBy" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_by" property="updateBy" jdbcType="VARCHAR"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 基础字段 -->
    <sql id="Base_Column_List">
        id
        , parent_id, menu_type, menu_name, route_name, route_path, path_param, component,
        icon_type, icon, local_icon, i18n_key, `order`, keep_alive, constant, href,
        hide_in_menu, active_menu, multi_tab, fixed_index_in_tab, status,
        create_by, create_time, update_by, update_time
    </sql>

    <!-- 查询所有常量菜单列表 -->
    <select id="selectConstantMenus" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM menu
        WHERE constant = 1 AND status = 1
        ORDER BY parent_id ASC, `order` ASC, create_time ASC
    </select>

    <!-- 查询所有非常量菜单列表 -->
    <select id="selectNotConstantMenus" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM menu
        WHERE constant = 0 AND status = 1
        ORDER BY parent_id ASC, `order` ASC, create_time ASC
    </select>

    <!-- 根据ID查询菜单 -->
    <select id="selectById" parameterType="long" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM menu
        WHERE id = #{id}
    </select>

    <!-- 根据路由名称查询菜单 -->
    <select id="selectByRouteName" parameterType="string" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM menu
        WHERE route_name = #{routeName}
    </select>

    <!-- 根据父级菜单ID查询子菜单 -->
    <select id="selectByParentId" parameterType="long" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM menu
        WHERE parent_id = #{parentId}
        ORDER BY `order` ASC
    </select>

    <!-- 插入菜单 -->
    <insert id="insert" parameterType="com.github.kevin.oasis.models.entity.Menu" useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO menu (parent_id, menu_type, menu_name, route_name, route_path, path_param, component,
                          icon_type, icon, local_icon, i18n_key, `order`, keep_alive, constant, href,
                          hide_in_menu, active_menu, multi_tab, fixed_index_in_tab, status,
                          create_by, create_time, update_by, update_time)
        VALUES (#{parentId}, #{menuType}, #{menuName}, #{routeName}, #{routePath}, #{pathParam}, #{component},
                #{iconType}, #{icon}, #{localIcon}, #{i18nKey}, #{order}, #{keepAlive}, #{constant}, #{href},
                #{hideInMenu}, #{activeMenu}, #{multiTab}, #{fixedIndexInTab}, #{status},
                #{createBy}, NOW(), #{updateBy}, NOW())
    </insert>

    <!-- 更新菜单 -->
    <update id="update" parameterType="com.github.kevin.oasis.models.entity.Menu">
        UPDATE menu
        SET parent_id          = #{parentId},
            menu_type          = #{menuType},
            menu_name          = #{menuName},
            route_name         = #{routeName},
            route_path         = #{routePath},
            path_param         = #{pathParam},
            component          = #{component},
            icon_type          = #{iconType},
            icon               = #{icon},
            local_icon         = #{localIcon},
            i18n_key           = #{i18nKey},
            `order`            = #{order},
            keep_alive         = #{keepAlive},
            constant           = #{constant},
            href               = #{href},
            hide_in_menu       = #{hideInMenu},
            active_menu        = #{activeMenu},
            multi_tab          = #{multiTab},
            fixed_index_in_tab = #{fixedIndexInTab},
            status             = #{status},
            update_by          = #{updateBy},
            update_time        = NOW()
        WHERE id = #{id}
    </update>

    <!-- 批量删除菜单 -->
    <delete id="deleteMenusByIds">
        DELETE FROM menu
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>

